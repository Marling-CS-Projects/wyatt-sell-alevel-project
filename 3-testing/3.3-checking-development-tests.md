# 3.3 Checking Development Tests

A complete set of tests should be run to assess the final solution.

They could be plucked from the tests in your dev cycles, or be new tests that run the system as a whole.

# Cycle 1

## Tests

| Test | Instructions                                  | What I expect                                                              | What actually happens | Pass/Fail |
| ---- | --------------------------------------------- | -------------------------------------------------------------------------- | --------------------- | --------- |
| 1    | Visit http://locahost:3000                    | A simple UI is displayed with a list of messages received from the server. | As expected           | Pass      |
| 2    | Visit localhost:3000, and observe server logs | A "Client connected message" is logged to the console.                     | As expected           | Pass      |

## Evidence

![](<../.gitbook/assets/image (1) (1) (1) (3).png>)![](<../.gitbook/assets/image (5) (1) (1) (1).png>)

# Cycle 2

## Tests

| Test | Instructions                                             | What I expect                                                                                                                                         | What actually happens |
| ---- | -------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------- |
| 1    | Click login and then login with Google                   | The user will be redirected to the main page, with their profile and join/create buttons displayed                                                    | As expected           |
| 2    | \[Logged In] Click create and then create again          | The user will be redirected to a page with options (TBI), and then will be redirected to a lobby screen with the join code and players connected      | As expected           |
| 3    | \[Logged In] Click join and then enter a valid join code | The user will be redirected to an code input screen, which once entered will redirect them to a lobby screen with the join code and players connected | As expected           |
| 4    | \[Logged In + In game] Click switch roles                | The users role is switched                                                                                                                            | As expected           |
| 5    | \[Logged In] Click Logout                                | The user is logged out                                                                                                                                | As expected           |

## Evidence

{% embed url="https://drive.google.com/file/d/1U3y3_Cjxutz4W6TtB6Cx9WeVKDqSqxMx/view?usp=sharing" %}
Video evidence of the above tests
{% endembed %}

{% hint style="info" %}
An unexpected minor issue occurred while recording the evidence, where the "join code" was only 5 characters instead of 6. This is because my `generateJoinCode` function had a slight bug where it would occassionaly select an item at index 36, which was undefined (as lists have a start index of 0 in Javascript). I fixed this by removing the \
"+ 1" part of the function
{% endhint %}

# Cycle 3

## Tests

| Test | Instructions                                                          | What I expect                                                                                                              | What actually happens | Pass/Fail |
| ---- | --------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------- | --------------------- | --------- |
| 1    | A player creates and starts a game with no other players              | A map is displayed with their location indicator in the centre, and no other indicators rendered                           | As expected           | Pass      |
| 2    | A Hunter and Hunted player join the same game, and the host starts it | Each player should see a map with only their own location marker rendered                                                  | As expected           | Pass      |
| 3    | 2 Hunted players join the same game, and the host starts it           | Each player should see a map with only their own location marker rendered                                                  | As expected           | Pass      |
| 4    | 2 Hunter players join the same game, and the host starts it           | Both players should see a map with their own location in the centre in blue, AND the other players location marker in red. | As expected           |           |
| 5    | Create and start a game                                               | The map renders a satellite view, and supports zoom with a dynamic accuracy circle                                         | As expected           |           |

## Evidence

![](<../.gitbook/assets/localhost_3000_(iPhone 12 Pro).png>)![](<../.gitbook/assets/localhost_3000_(iPhone 12 Pro) (1) (2).png>)

The first screenshot shows the location view all players will see of themselves - a blue dot with a translucent circle displaying their accuracy.

The second screenshot is an example of what a hunter might see, with their fellow teammates rendered in as the red circle, and their location rendered in blue.

# Cycle 4

## Tests

| Test | Instructions                                                                                    | What I expect                                                                                            | What actually happens | Pass/Fail |
| ---- | ----------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------- | --------------------- | --------- |
| 1    | The host draws (and optionally edits) an polygon, before creating and starting the game         | The polygon can be drawn and edited, and rendered as red outline when the host loads into the game       | As expected           | Pass      |
| 2    | The host attempts to draw two polygons                                                          | The controls for drawing a new polygon should disappear, after the first one is drawn                    | As expected           | Pass      |
| 3    | The host draws a polygon, another player joins the game, and the game is started                | Both players should see the game area rendered with a red outline                                        | As expected           | Pass      |
| 4    | Create and start a game, pan away from your location marker, and click the recenter button      | The map should pan and zoom back to your location                                                        | As expected           | Pass      |
| 5    | Create and start a game with two Hunters, and click the indicator of the other hunter           | A popup should appear with the other players username and role                                           | As expected           | Pass      |
| 6    | Create and start a game with two players and emulate the location being outside of the boundary | A popup should appear on both players screens alerting them that this player is out of bounds            | As expected           |           |
| 7    | Create and start a game and emulate the location being near to the boundary                     | A popup should appear on the players screen with a warning and if applicable their device should vibrate | As expected           |           |

## Evidence

![](<../.gitbook/assets/localhost_3000_(iPhone 12 Pro) (2).png>)![](<../.gitbook/assets/localhost_3000_(iPhone 12 Pro) (6).png>)

The first screenshot shows the game creation screen where the host can define the playable area. As shown in the image, there is no button to create a polygon, only to edit and delete, once the first one has been created.

The second screenshot shows the in-game screen:

- At the footer, the username, game-time and role are displayed. There are also two currently non-functional buttons in preparation for later functionality.
- The recenter button (visible in both) is in the bottom right, easy to reach and will pan the map with an animation after pressing
- There is an example popup above the red indicator showing details about the player when their indicator is clicked
- At the very top, there is an alert triggered as soon as the other player moved out of bounds

# Cycle 5

## Tests

| Test | Instructions                                                                | What I expect                                                                                                                     | What actually happens | Pass/Fail |
| ---- | --------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------- | --------------------- | --------- |
| 1    | Load the app, and create a new game                                         | A new font and more readable colours.                                                                                             | As expected           | Pass      |
| 2    | Create a game, have two players join it, and have one refresh their browser | A page appears with a "Reconnect" and a "Leave Game" button, and a disconnection notification appears on the other players screen | As expected           | Pass      |
| 3    | (Following from 2) Click the Reconnect button                               | The user rejoins the game, and a reconnection notification appears on the other players screen                                    | As expected           | Pass      |
| 4    | (Following from 2) Click the Leave Game button                              | The user is taken to the Join/Create page                                                                                         | As expected           | Pass      |

## Evidence

![](<../.gitbook/assets/localhost_3000_(iPhone 12 Pro) (9).png>)![](<../.gitbook/assets/localhost_3000_(iPhone 12 Pro) (10).png>)

The first screenshot shows the UI if a user disconnects from a game, where the user can decide to leave the game for good, or to rejoin.

The second screenshot shows the current in-game UI with the new font, as well as the notification that will appear when a user leaves a game.

# Cycle 6

## Tests

| Test | Instructions                            | What I expect                                                     | What actually happens                             | Pass/Fail |
| ---- | --------------------------------------- | ----------------------------------------------------------------- | ------------------------------------------------- | --------- |
| 1    | Create & start a game with a small area | Items to be randomly and evenly distributed across the map        | As expected                                       | Pass      |
| 2    | Create & start a game with a large area | Items to be randomly and evenly distributed across the map        | The game hangs before the create request timeouts | Fail      |
| 3    | (Within Game) Click on an item          | A popup appears detailing item stats                              | As expected                                       | Pass      |
| 4    | (Within Game) Observe item distribution | The rarities and types are appropriately distributed (noticeably) | The distribution is too subtle and seems random   | Fail      |

{% hint style="danger" %}
Although not an explicit test, the game rendered and ran incredibly slowly, with location changes taking several seconds to be reflected on-screen. I suspect this is due to unnecessary re-rendering of the entire items array, as well as the costly re-computation of item distances. I will fix this next Cycle as it is a non-trivial fix.
{% endhint %}

### Failing Tests

#### Test 2

There doesn't appear to be a great way to rectify this issue - it lies with the efficiency of the algorithm (a respectable O(n)), which can't handle generating millions of evenly distributed items. This could be rectified by using simple random generation, but would result in the caveats discussed earlier.

I think the simplest solution is to reject a game creation with an error if the bounding area is too large. In future, I could experiment with "just-in-time" generation, generating items within a certain area around players, and restricting the panning and zooming on the map (similarly to [#pokemon-go](../1-analysis/1.3-research-the-problem.md#pokemon-go "mention"))

```typescript
app.post('/create', (req, res) => {
...
    const {width, height} = dimensions(result.data.options.vertices);
    // If the game is more than 30km^2, return an error
    if (width * height > 30 * 1000 ** 2) {
        return res.status(400).send(JSON.stringify({data: 'Map is too large'}));
    }
...
});
```

#### Test 4

I rectified this by multiplying the distribution variable by a constant in the `typesToSelect` list, to increase the disparity in probabilities and modified the `rarityArr` element ratio from 3:2:1, to 9:3:1

<pre class="language-typescript" data-line-numbers><code class="lang-typescript">const typesToSelect = types[type].flatMap(type =>
<strong>    Array(10 - type.baseRarity * 3).fill(type)
</strong>) as typeof types['hunter' | 'hunted'];

const item = typesToSelect[Math.floor(Math.random() * typesToSelect.length)];

const rarityArr = [1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 3].filter(v => v >= item.baseRarity)</code></pre>

## Evidence

#### Test 1

![](<../.gitbook/assets/localhost_3000_create(iPhone 12 Pro) (1).png>)

#### Test 2 (Rectified)

![](<../.gitbook/assets/localhost_3000_create(iPhone 12 Pro).png>)

#### Test 3

![](<../.gitbook/assets/localhost_3000_create(iPhone 12 Pro) (3).png>)

#### Test 4 (Rectified)

<figure><img src="../.gitbook/assets/localhost_3000_create.png" alt=""><figcaption></figcaption></figure>

# Cycle 7

## Tests

| Test | Instructions                                                                   | What I expect                                                                                                                  | What actually happens                                                                     | Pass/Fail |
| ---- | ------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------ | ----------------------------------------------------------------------------------------- | --------- |
| 1    | Create a game with a duration of 1 minute, with a Hunted and a Hunter player   | Once 1 minute has passed, the game screen shows Hunted Win/ Hunters Lose                                                       | As expected                                                                               | Pass      |
| 2    | (1 cont.) After the Win/Lose screen, wait for the "Exiting" countdown to pass. | Both players should be returned to the Join/Create screen                                                                      | As expected                                                                               | Pass      |
| 3    | Create a game with a duration of 2 minutes                                     | At the 1 minute point, a notification should appear                                                                            | As expected                                                                               | Pass      |
| 4    | (1 cont.) Join both on same device                                             | A large catch button should appear on the Hunters screen                                                                       | As expected                                                                               | Pass      |
| 5.1  | (3 cont.) Click the catch button                                               | The Hunted player should see a game over message, and then be removed from the the game, and the Catch button should disappear | As expected, except the player does not see a game over screen and the leaving is instant | Fail      |
| 5.2  | -                                                                              | The Hunter should see a "Hunter Win" screen.                                                                                   | As expected                                                                               | Pass      |

## Evidence

![](<../.gitbook/assets/image (2) (1).png>)![](<../.gitbook/assets/image (8).png>)

The two above images show the Catch button, and the "Caught" message that appears before the caught player is returned to the Create/Join page.

{% hint style="info" %}
The issue with the leaving being instant and the message not being displayed was fixed by trigger the socket disconnection from the client - the issue stemmed from the client exiting the game the instant the socket disconnected.

<pre class="language-typescript"><code class="lang-typescript">toast.error(`You were caught! Game Over`);
setTimeout(() => {
    // Moved to the client
    socket?.disconnect();
<strong>    setGame(null);
</strong>    setSocket(null);
}, 3000);</code></pre>

{% endhint %}

<figure><img src="../.gitbook/assets/image (4) (3).png" alt=""><figcaption><p>This shows the Win/Loss screens that appear when the game is over</p></figcaption></figure>

![](<../.gitbook/assets/image (1) (5).png>)

This image shows an example of the the "1 Minute left" message

# Cycle 8

## Tests

| Test | Instructions                                                                                | What I expect                                                                                                                         | What actually happens | Pass/Fail |
| ---- | ------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------- | --------------------- | --------- |
| 1    | Create a game, and move towards an item (within \~20m)                                      | A green "pick up" button should appear at the bottom of the user's screen                                                             | As expected           | Pass      |
| 1.1  | Click the pick-up button, and then click the ðŸŽ’                                             | The item disappears from the map, and is displayed in the inventory                                                                   | As expected           | Pass      |
| 1.2  | Continue until you've picked up 6 items, and move within range of another item              | A red "pick up" button should appear, which will display an "Inventory Full" message when clicked. No change to the item should occur | As expected           | Pass      |
| 2    | Pickup an item, click on ðŸŽ’ and then click on an item                                       | A page should appear with more details about the item, a drop button and an action button                                             | As expected           | Pass      |
| 2.1  | Move, and then click the drop button                                                        | The item should disappear from the inventory, and the user should see the item at their current location on the map.                  | As expected           | Pass      |
| 3    | Repeat tests 2 and 2.1 with a second player of the same type connected and observe the map. | An item should disappear from the map, before reappearing again in a different location                                               | As expected           | Pass      |

{% hint style="info" %}
Although not explicitly a test, when adding a second player and clicking "Switch Role", the items would be incorrect for their role when the game started. To rectify this, I created a new socket message called `game-update`, allowing me to update the entire item array on the client, similarly to the `game-init` event.

I called this from within the `player.updatePref()` method, sending the items appropriate for the players new role to the client.
{% endhint %}

## Evidence

{% embed url="https://drive.google.com/file/d/1jPOHC3hXSvu8Z1Zmkveb-NkuyWEFFhwD/view?usp=sharing" %}

# Cycle 9

## Tests

| Test | Instructions                                                                                              | What I expect                                                                                                                                              | What actually happens | Pass/Fail |
| ---- | --------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------- | --------- |
| 1    | Create a game with a Hunter and Hunted player (within 1km), and the Hunter picks up and uses a Drone item | An orange heat-map should appear on the Hunter players screen, with one of the areas being where the Hunted player is (A toggle button should also appear) | As expected           | Pass      |
| 1.1  | After using the item, click ðŸŽ’ and then click on the relevant item.                                       | There should be a green background on the thumbnail and a countdown on the use button                                                                      | As expected           | Pass      |
| 1.2  | After the item is used, listen to the audio on the Hunted players tab                                     | A drone buzzing sound should be audible                                                                                                                    | As expected           | Pass      |
| 2    | (Following on from 1) The Hunted player should pickup and use a GPS Jammer item                           | The Hunter should see a glitching effect on top of their map                                                                                               | As expected           | Pass      |
| 3    | Wait until the item duration expires on the Drone Search & GPS Jammer                                     | The items should be removed from the players' inventories                                                                                                  | As expected           | Pass      |

## Evidence

{% embed url="https://drive.google.com/file/d/1LG9hiPI3MLBpxFbfUP--E9eIXpBw3R4I/view?usp=sharing" %}

{% hint style="info" %}
Although the drone buzzing sound is not audible in the recording, one can see that it occurs when a speaker icon appears in the right edge of the tab.
{% endhint %}
